<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<title>google map sample</title>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript">

var map = null;
var marker_list = new Array();
const MAX_MARKERS = 10

function addMarker(map, lat, lng) {
	var latlng = new google.maps.LatLng(lat, lng);
	var marker = new google.maps.Marker({
	            position: latlng
	});
	marker.setMap(map);
	marker_list.push(marker);
}
function setCenter(map, lat, lng) {
	map.setCenter(latlng);
}
function createMap(lat,lng) {
	var latlng = new google.maps.LatLng(lat, lng);
	var myOptions = {
	    zoom: 15,
	    center: latlng,
	    mapTypeId: google.maps.MapTypeId.ROADMAP
	};
	return new google.maps.Map(document.getElementById("map_canvas"), myOptions);
}

function locupdate(pos) { 
	if (marker_list.length == 0){
	    map = createMap(pos.coords.latitude, pos.coords.longitude);
	}
	if (map != null) {
		addMarker(map, pos.coords.latitude, pos.coords.longitude);
		setCenter(map, pos.coords.latitude, pos.coords.longitude);
	}
	if (marker_list.length > MAX_MARKERS) {
		var marker = marker_list.shift();
		marker.setMap(null);
	}
}

function handleError(a) {
	alert("error: " + a.code + "");
}

window.onload = function(){
	if (navigator.geolocation) {
		var options = {
			timeout: 10000
		};
		navigator.geolocation.watchPosition(locupdate, handleError, options);
	}
};

	</script>
	<style type="text/css">

html, body 		{ height: 100%; margin: 0; padding: 0; }
#map_canvas 	{ width: 100%; height:100%; }

	</style>
</head>
<body>
	<div id="map_canvas"></div>
</body>
</html>
